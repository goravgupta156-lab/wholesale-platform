<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rishu Ornaments | Advance Admin Panel</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        
        /* High Security Login Box */
        .login-box { max-width: 400px; margin: 100px auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center; }
        .login-box input { width: 90%; margin-bottom: 20px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; }
        
        .dashboard { display: none; }

        /* Amazon Style Header */
        .header-tools { 
            position: sticky; top: 0; background: #232f3e; color: white; z-index: 1000; 
            padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn-save { background: #febd69; color: #131921; border: none; padding: 12px 25px; font-weight: bold; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        .btn-save:hover { background: #f3a847; }

        .container { padding: 20px; }
        .upload-section { background: white; padding: 30px; border-radius: 12px; margin-bottom: 25px; border: 2px dashed #007bff; text-align: center; }
        
        /* Advanced Table Style */
        .table-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 15px; text-align: left; border-bottom: 2px solid #dee2e6; color: #495057; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        
        .low-stock { background-color: #fff5f5 !important; border-left: 5px solid #ff4d4d; }
        .cat-rate { font-weight: bold; color: #B12704; font-size: 1.2em; }
        input[type="number"], input[type="text"] { padding: 8px; border: 1px solid #ddd; border-radius: 5px; width: 100px; }
        
        .img-preview { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }
        .status-badge { padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .active-badge { background: #e6fffa; color: #38b2ac; }
    </style>
</head>
<body>

    <div id="loginSection" class="login-box">
        <h2 style="color:#232f3e;">Rishu Ornaments Security</h2>
        <p>Admin Access Only</p>
        <input type="password" id="passInput" placeholder="Password">
        <input type="number" id="pinInput" placeholder="4-Digit PIN" style="display:none;">
        <button onclick="checkLogin()" style="width:95%; padding:15px; background:#febd69; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">Verify Identity</button>
    </div>

    <div id="adminDashboard" class="dashboard">
        <div class="header-tools">
            <h2 style="margin:0;">Rishu Dashboard</h2>
            <div>
                <label>Global Margin: </label>
                <input type="number" id="globalPct" value="40" style="width:50px;" onchange="updateAllRates()"> %
                <button class="btn-save" onclick="saveToGoogleSheets()">ðŸ’¾ SAVE ALL TO CLOUD</button>
            </div>
        </div>

        <div class="container">
            <div class="upload-section">
                <h3>Bulk Upload Inventory</h3>
                <p style="color: #666;">Drag & drop photos (Format: RO101_short_6pcs.jpg)</p>
                <input type="file" id="fileUpload" multiple accept="image/*" onchange="handleBulkUpload()">
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Photo</th>
                            <th>Product Detail</th>
                            <th>Basic Rate (Admin)</th>
                            <th>Catalog Rate (Client)</th>
                            <th>Weight (g)</th>
                            <th>Stock Qty</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // REPLACE THIS with your Google Web App URL from Step 1
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyqwdu9HZ-EoF2o8f8D7H_jsCQvLdXQ0fvGc7R58a7cfqZbMI51-Had_wPg-nds10aU/exec"; 

        function checkLogin() {
            const pass = document.getElementById('passInput').value;
            const pinBox = document.getElementById('pinInput');
            const pin = pinBox.value;

            if (pass === "admin123") {
                pinBox.style.display = "block";
                if (pin === "1995") {
                    document.getElementById('loginSection').style.display = "none";
                    document.getElementById('adminDashboard').style.display = "block";
                }
            } else { alert("Access Denied!"); }
        }

        function handleBulkUpload() {
            const files = document.getElementById('fileUpload').files;
            const tableBody = document.getElementById('productTableBody');
            const pct = document.getElementById('globalPct').value;
            
            for (let file of files) {
                // AUTO-NAMING LOGIC (RO101_short_6pcs.jpg)
                let fileName = file.name.split('.')[0];
                let parts = fileName.split('_');
                let pCode = parts[0] || "NEW";
                let pType = parts[1] || "Normal";
                let pSize = parts[2] ? parts[2].replace('pcs','') : "1";
                
                let imgUrl = URL.createObjectURL(file); 
                
                let row = `
                    <tr class="product-row">
                        <td><img src="${imgUrl}" class="img-preview"></td>
                        <td>
                            <strong>${pCode}</strong><br>
                            <small>${pType} | ${pSize} pcs/pkt</small>
                        </td>
                        <td><input type="number" class="basic-rate" value="1000" oninput="calcRate(this)"></td>
                        <td class="cat-rate">${Math.round(1000 * (1 + pct/100))}</td>
                        <td><input type="number" class="weight" value="250"></td>
                        <td><input type="number" class="stock" value="21" oninput="checkStock(this)"></td>
                        <td><button onclick="this.parentElement.parentElement.remove()" style="color:red; border:none; background:none; cursor:pointer;">Remove</button></td>
                    </tr>`;
                tableBody.innerHTML += row;
            }
        }

        function calcRate(input) {
            const pct = document.getElementById('globalPct').value;
            const basic = parseFloat(input.value) || 0;
            const catRateCell = input.parentElement.nextElementSibling;
            catRateCell.innerText = Math.round(basic * (1 + pct/100));
        }

        function updateAllRates() {
            document.querySelectorAll('.basic-rate').forEach(input => calcRate(input));
        }

        function checkStock(input) {
            const row = input.parentElement.parentElement;
            if (parseInt(input.value) < 21) { row.classList.add('low-stock'); }
            else { row.classList.remove('low-stock'); }
        }

        async function saveToGoogleSheets() {
            const rows = document.querySelectorAll('.product-row');
            let productData = [];

            rows.forEach(row => {
                productData.push({
                    name: row.cells[1].querySelector('strong').innerText,
                    type: row.cells[1].querySelector('small').innerText,
                    basicRate: row.querySelector('.basic-rate').value,
                    catalogRate: row.querySelector('.cat-rate').innerText,
                    weight: row.querySelector('.weight').value,
                    stock: row.querySelector('.stock').value
                });
            });

            // Calling Google Apps Script
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(productData)
                });
                alert("Data Synced to Google Sheets Successfully!");
            } catch (err) {
                alert("Sync Failed. Check Internet!");
            }
        }
    </script>
</body>
</html>